<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Meeting Transcription Assistant</title>
    <script src="{{ url_for('static', filename='instant_hide.js') }}"></script>
    <script src="{{ url_for('static', filename='page_debug.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='loading_diagnostic.js') }}"></script>
    <script>
        // IMMEDIATE loading indicator failsafe - runs as soon as script tag is parsed
        console.log('üö® IMMEDIATE FAILSAFE: Script tag loaded');
        
        // Set multiple timers to ensure loading indicator is hidden
        setTimeout(() => {
            console.log('üö® TIMER 1: Attempting to hide loading indicator');
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
                indicator.style.visibility = 'hidden';
                indicator.style.opacity = '0';
                console.log('‚úÖ TIMER 1 SUCCESS: Hidden loading indicator');
            }
        }, 1500);
        
        setTimeout(() => {
            console.log('üö® TIMER 2: Attempting to hide loading indicator');
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
                indicator.style.visibility = 'hidden';
                indicator.style.opacity = '0';
                console.log('‚úÖ TIMER 2 SUCCESS: Hidden loading indicator');
            }
        }, 2500);
        
        setTimeout(() => {
            console.log('üö® TIMER 3: Final attempt to hide loading indicator');
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
                indicator.style.visibility = 'hidden';
                indicator.style.opacity = '0';
                indicator.remove(); // Remove entirely as last resort
                console.log('‚úÖ TIMER 3 SUCCESS: Removed loading indicator entirely');
            }
        }, 4000);
    </script>
</head>
<body>
    <script>
        // IMMEDIATE FIX - Execute before any DOM elements are parsed
        console.log('üö® IMMEDIATE: Inline script executing');
        
        // Set up immediate DOM observer
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üö® DOM LOADED: Setting up fixes');
            
            // Hide loading indicator immediately
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
                loadingIndicator.style.visibility = 'hidden';
                loadingIndicator.style.opacity = '0';
                console.log('‚úÖ HIDDEN: Loading indicator');
            }
            
            // Ensure app container is visible
            const appContainer = document.querySelector('.app-container');
            if (appContainer) {
                appContainer.style.display = 'block';
                appContainer.style.visibility = 'visible';
                appContainer.style.opacity = '1';
                console.log('‚úÖ VISIBLE: App container');
            }
            
            // Debug info
            console.log('üîç DEBUG: Current elements');
            console.log('- Loading indicator:', loadingIndicator ? 'Found' : 'Not found');
            console.log('- App container:', appContainer ? 'Found' : 'Not found');
            console.log('- Body background:', window.getComputedStyle(document.body).backgroundColor);
        });
        
        // Fallback timer
        setTimeout(function() {
            console.log('üö® FALLBACK: Executing backup visibility fix');
            const appContainer = document.querySelector('.app-container');
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            if (loadingIndicator) {
                loadingIndicator.remove();
                console.log('‚úÖ REMOVED: Loading indicator');
            }
            
            if (appContainer) {
                appContainer.style.display = 'block';
                appContainer.style.visibility = 'visible';
                appContainer.style.opacity = '1';
                appContainer.style.position = 'relative';
                appContainer.style.zIndex = '1';
                console.log('‚úÖ FORCED VISIBLE: App container');
            }
        }, 1000);
    </script>
    <!-- Loading indicator -->
    <div id="loadingIndicator" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
    ">
        <div style="text-align: center;">
            <div style="
                width: 40px;
                height: 40px;
                border: 4px solid #f3f3f3;
                border-top: 4px solid #007bff;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 0 auto 20px;
            "></div>
            <div style="color: #666; font-size: 16px;">Loading AI Meeting Transcription Assistant...</div>
            <div style="margin-top: 20px;">
                <button onclick="window.emergencyBypass && window.emergencyBypass()" style="
                    background: #ffc107;
                    color: #212529;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    display: none;
                " id="emergencyBypassBtn">Skip Loading (Emergency Mode)</button>
            </div>
            <script>
                // Show emergency bypass button after 2 seconds
                setTimeout(() => {
                    const btn = document.getElementById('emergencyBypassBtn');
                    if (btn) btn.style.display = 'inline-block';
                }, 2000);
                
                // Auto-hide loading indicator after 3 seconds if still visible
                setTimeout(() => {
                    const indicator = document.getElementById('loadingIndicator');
                    if (indicator && indicator.style.display !== 'none') {
                        console.warn('üö® AUTO-HIDE: Loading indicator timeout');
                        indicator.style.display = 'none';
                    }
                }, 3000);
            </script>
        </div>
    </div>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Only hide the specific loading indicator, not all content */
        #loadingIndicator {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        /* Ensure main application content is visible */
        .app-container {
            display: flex !important;
            flex-direction: column !important;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 100vh !important;
            position: relative !important;
            z-index: 1 !important;
        }
        
        body {
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }
    </style>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1 class="header__title">AI Meeting Transcription Assistant</h1>
            <div class="header__status">
                <div class="service-status" id="serviceStatus">
                    <span class="service-indicator" id="transcriptionService">Web Speech</span>
                    <span class="service-indicator" id="aiService">Simulation</span>
                    <span class="mode-indicator" id="modeIndicator">
                        <span class="mode-icon">üé§</span>
                        <span class="mode-text">Live Mode</span>
                    </span>
                </div>
                <div class="status-indicator" id="statusIndicator">
                    <span class="status-dot"></span>
                    <span class="status-text" id="statusText">Ready</span>
                </div>
                <div class="communication-status communication-status--disconnected" id="communicationStatus">
                    <span class="comm-indicator" id="commIndicator" title="Communication Mode">
                        <span class="comm-icon">üîÑ</span>
                        <span class="comm-text" id="commText">Initializing...</span>
                    </span>
                    <div class="comm-status-dot"></div>
                </div>
                <div class="session-timer" id="sessionTimer">00:00:00</div>
                <button class="btn btn--outline btn--sm" id="settingsBtn">‚öôÔ∏è Settings</button>
            </div>
        </header>

        <!-- JavaScript Status Indicator -->
        <div class="js-status-banner" id="jsStatusBanner" style="
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            padding: 12px 20px;
            margin: 0;
            text-align: center;
            font-size: 14px;
        ">
            <span id="jsStatusText">‚ö†Ô∏è JavaScript Status: Unknown - Some features may be limited</span>
            <span style="margin-left: 15px;">
                <a href="/fixed-main" style="color: #856404; text-decoration: underline;">Try No-JS Version</a> |
                <a href="/browser-test" style="color: #856404; text-decoration: underline;">Test Browser</a>
            </span>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mode Selection -->
            <section class="mode-selection">
                <div class="mode-tabs">
                    <button class="mode-tab active" data-mode="live" id="liveModeTab" title="Switch to Live Recording (Ctrl+M)">
                        <span class="mode-icon">üé§</span>
                        Live Recording
                    </button>
                    <button class="mode-tab" data-mode="upload" id="uploadModeTab" title="Switch to File Upload (Ctrl+M)">
                        <span class="mode-icon">üìÅ</span>
                        File Upload
                    </button>
                    <div class="mode-shortcut-hint">
                        <span class="shortcut-text">Press Ctrl+M to switch modes</span>
                    </div>
                </div>
            </section>

            <!-- Live Recording Control Panel -->
            <section class="control-panel" id="liveControlPanel">
                <div class="control-group">
                    <button class="btn btn--primary btn--lg" id="recordButton" data-help="recordButton">
                        <span class="btn-icon" id="recordIcon">üé§</span>
                        <span id="recordText">Start Recording</span>
                    </button>
                    <button class="btn btn--secondary" id="pauseButton" disabled>
                        <span class="btn-icon">‚è∏Ô∏è</span>
                        Pause
                    </button>
                    <button class="btn btn--outline" id="stopButton" disabled>
                        <span class="btn-icon">‚èπÔ∏è</span>
                        Stop
                    </button>
                    <button class="btn btn--outline btn--sm" id="simulateLanguageBtn">
                        <span class="btn-icon">üåê</span>
                        Simulate Language Detection
                    </button>
                    <button class="btn btn--secondary btn--sm" id="speakerDiarizationNavBtn" onclick="window.location.href='/speaker-diarization'">
                        <span class="btn-icon">üë•</span>
                        Speaker Diarization
                    </button>
                </div>
                
                <!-- HTML Form Fallbacks (No JavaScript Required) -->
                <div class="no-js-controls" style="margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">üîß No-JavaScript Controls:</div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <form method="post" action="/api/recording/start" style="display: inline;">
                            <button type="submit" class="btn btn--primary btn--sm" style="font-size: 12px;">
                                üé§ Start Recording
                            </button>
                        </form>
                        <form method="post" action="/api/recording/stop" style="display: inline;">
                            <button type="submit" class="btn btn--outline btn--sm" style="font-size: 12px;">
                                ‚èπÔ∏è Stop Recording
                            </button>
                        </form>
                        <form method="get" action="/api/session/status" style="display: inline;">
                            <button type="submit" class="btn btn--secondary btn--sm" style="font-size: 12px;">
                                üìä Check Status
                            </button>
                        </form>
                        <form method="get" action="/api/transcript/latest" style="display: inline;">
                            <button type="submit" class="btn btn--secondary btn--sm" style="font-size: 12px;">
                                üìÑ Get Transcript
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="session-info">
                    <div class="info-item">
                        <span class="info-label">Speakers:</span>
                        <span class="info-value" id="speakerCount">0</span>
                        <button class="btn btn--outline btn--sm" id="speakerDiarizationBtn" title="Configure Speaker Diarization">
                            <span class="btn-icon">üë•</span>
                        </button>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Language:</span>
                        <select class="form-control" id="languageSelect">
                            <option value="en-US">English (US)</option>
                            <option value="en-GB">English (UK)</option>
                            <option value="es-ES">Spanish</option>
                            <option value="fr-FR">French</option>
                            <option value="de-DE">German</option>
                            <option value="it-IT">Italian</option>
                            <option value="pt-BR">Portuguese</option>
                            <option value="ja-JP">Japanese</option>
                            <option value="ko-KR">Korean</option>
                            <option value="zh-CN">Chinese (Simplified)</option>
                        </select>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Detected:</span>
                        <div class="language-detection-display" id="languageDetectionDisplay">
                            <span class="detected-language" id="detectedLanguage">
                                <span class="language-flag">üåê</span>
                                <span class="language-name">Auto-detecting...</span>
                                <span class="confidence-indicator" id="confidenceIndicator"></span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="audio-visualizer" id="audioVisualizer">
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                </div>
            </section>

            <!-- File Upload Panel -->
            <section class="upload-panel hidden" id="uploadPanel">
                <div class="upload-zone" id="uploadZone" data-help="uploadZone">
                    <div class="upload-zone-content">
                        <div class="upload-icon">üìÅ</div>
                        <h3>Upload Audio File</h3>
                        <p>Drag and drop your audio file here, or click to browse</p>
                        <div class="supported-formats">
                            <span class="format-tag">MP3</span>
                            <span class="format-tag">WAV</span>
                            <span class="format-tag">M4A</span>
                            <span class="format-tag">FLAC</span>
                        </div>
                        <button class="btn btn--primary" id="browseFilesBtn">
                            <span class="btn-icon">üìÇ</span>
                            Browse Files
                        </button>
                    </div>
                    <input type="file" id="audioFileInput" accept=".mp3,.wav,.m4a,.flac,.mp4,.wma" style="display: none;">
                </div>
                
                <!-- HTML Form File Upload (No JavaScript Required) -->
                <div class="no-js-upload" style="margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 15px;">üîß No-JavaScript File Upload:</div>
                    <form method="post" action="/api/file-upload/upload" enctype="multipart/form-data">
                        <div style="margin-bottom: 15px;">
                            <input type="file" name="audio_file" accept=".mp3,.wav,.m4a,.flac,.mp4,.wma" 
                                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%; max-width: 300px;">
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button type="submit" class="btn btn--primary btn--sm">
                                üöÄ Upload & Transcribe
                            </button>
                            <button type="reset" class="btn btn--outline btn--sm">
                                üîÑ Clear Selection
                            </button>
                        </div>
                    </form>
                </div>

                <!-- File Upload Progress -->
                <div class="upload-progress hidden" id="uploadProgress">
                    <div class="upload-file-info">
                        <div class="file-icon">üéµ</div>
                        <div class="file-details">
                            <div class="file-name" id="uploadFileName">audio_file.mp3</div>
                            <div class="file-size" id="uploadFileSize">2.5 MB</div>
                        </div>
                        <button class="btn btn--outline btn--sm" id="cancelUploadBtn">Cancel</button>
                    </div>
                    
                    <div class="progress-section">
                        <div class="progress-label">
                            <span id="progressStatus">Uploading...</span>
                            <span id="progressPercentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-details">
                            <span id="progressDetails">Preparing file...</span>
                        </div>
                    </div>

                    <div class="transcription-progress hidden" id="transcriptionProgress">
                        <div class="transcription-status">
                            <div class="status-icon">‚ö°</div>
                            <div class="status-text">
                                <div class="status-title">Processing Audio</div>
                                <div class="status-subtitle" id="transcriptionStatus">Analyzing audio file...</div>
                            </div>
                        </div>
                        <div class="estimated-time">
                            <span>Estimated time: </span>
                            <span id="estimatedTime">2-3 minutes</span>
                        </div>
                    </div>
                </div>

                <!-- Upload Error Display -->
                <div class="upload-error hidden" id="uploadError">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div class="error-content">
                        <h4>Upload Failed</h4>
                        <p id="errorMessage">An error occurred while uploading your file.</p>
                        <div class="error-actions">
                            <button class="btn btn--primary" id="retryUploadBtn">Try Again</button>
                            <button class="btn btn--outline" id="selectNewFileBtn">Select Different File</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Transcript Display -->
                <section class="transcript-section">
                    <div class="transcript-header">
                        <h2>Live Transcript</h2>
                        <div class="transcript-controls">
                            <button class="btn btn--sm btn--outline" id="clearTranscript">Clear</button>
                            <button class="btn btn--sm btn--outline" id="scrollToBottom">Scroll to Bottom</button>
                        </div>
                    </div>
                    <div class="transcript-container" id="transcriptContainer">
                        <div class="transcript-placeholder" id="transcriptPlaceholder">
                            <div class="placeholder-icon">üéôÔ∏è</div>
                            <p>Click "Start Recording" to begin transcription</p>
                            <p class="placeholder-tip">Tip: Speak clearly and allow brief pauses between speakers</p>
                        </div>
                        <div class="transcript-content" id="transcriptContent"></div>
                    </div>
                </section>

                <!-- AI Features Sidebar -->
                <aside class="sidebar">
                    <!-- AI Summary -->
                    <div class="sidebar-section">
                        <h3>AI Summary</h3>
                        <button class="btn btn--primary btn--full-width" id="generateSummary" data-help="generateSummary">
                            Generate Summary
                        </button>
                        <div class="summary-content" id="summaryContent">
                            <p class="text-muted">No summary available yet. Generate a summary after recording.</p>
                        </div>
                    </div>

                    <!-- Translation -->
                    <div class="sidebar-section">
                        <h3>Translation</h3>
                        <div class="form-group">
                            <select class="form-control" id="translationTarget">
                                <option value="">Select target language</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="it">Italian</option>
                                <option value="pt">Portuguese</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                                <option value="zh">Chinese</option>
                                <option value="my">Myanmar (Burmese)</option>
                                <option value="hi">Hindi</option>
                                <option value="bn">Bengali</option>
                            </select>
                        </div>
                        <button class="btn btn--secondary btn--full-width" id="translateText">
                            Translate Transcript
                        </button>
                        <div class="translation-content" id="translationContent"></div>
                    </div>

                    <!-- Keywords -->
                    <div class="sidebar-section">
                        <h3>Keywords</h3>
                        <div class="keyword-controls">
                            <button class="btn btn--outline btn--sm" id="extractKeywords">Extract Keywords</button>
                            <button class="btn btn--outline btn--sm" id="highlightKeywords">Highlight</button>
                        </div>
                        <div class="keywords-list" id="keywordsList">
                            <p class="text-muted">Keywords will appear here after extraction</p>
                        </div>
                    </div>

                    <!-- Custom Dictionary -->
                    <div class="sidebar-section">
                        <h3>Custom Dictionary</h3>
                        <div class="form-group">
                            <input type="text" class="form-control" id="newWord" placeholder="Add custom word">
                            <button class="btn btn--secondary btn--sm" id="addWord">Add</button>
                        </div>
                        <div class="dictionary-list" id="dictionaryList"></div>
                    </div>

                    <!-- Language Detection -->
                    <div class="sidebar-section">
                        <h3>Language Detection</h3>
                        <div class="language-stats" id="languageStats" data-help="languageStats">
                            <div class="stats-placeholder">
                                <p class="text-muted">Language statistics will appear here during transcription</p>
                            </div>
                        </div>
                        
                        <!-- Language Timeline -->
                        <div class="language-timeline-container">
                            <h4>Language Timeline</h4>
                            <div class="language-timeline" id="languageTimeline">
                                <div class="timeline-placeholder">
                                    <p class="text-muted">Timeline will show language changes during the session</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Toggle Timeline View -->
                        <button class="btn btn--outline btn--sm btn--full-width" id="toggleTimelineBtn">
                            Show Detailed Timeline
                        </button>
                    </div>

                    <!-- Export -->
                    <div class="sidebar-section">
                        <h3>Export</h3>
                        <div class="form-group">
                            <select class="form-control" id="exportFormat">
                                <option value="txt">Plain Text (.txt)</option>
                                <option value="json">JSON Format (.json)</option>
                                <option value="pdf">PDF Document (.pdf)</option>
                                <option value="docx">Word Document (.docx)</option>
                            </select>
                        </div>
                        <button class="btn btn--primary btn--full-width" id="exportTranscript" data-help="exportTranscript">
                            Export Transcript
                        </button>
                    </div>
                </aside>
            </div>

            <!-- Meeting History -->
            <section class="history-section" id="historySection">
                <div class="history-header">
                    <h2>Meeting History</h2>
                    <button class="btn btn--outline btn--sm" id="toggleHistory">Show History</button>
                </div>
                <div class="history-content" id="historyContent" style="display: none;">
                    <div class="history-search">
                        <input type="text" class="form-control" id="historySearch" placeholder="Search meetings...">
                    </div>
                    <div class="history-list" id="historyList"></div>
                </div>
            </section>
        </main>

        <!-- Modal for Meeting Details -->
        <div class="modal hidden" id="meetingModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Meeting Details</h3>
                    <button class="modal-close" id="modalClose">&times;</button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Meeting details will be populated here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn--outline" id="modalCloseBtn">Close</button>
                    <button class="btn btn--primary" id="loadMeeting">Load Meeting</button>
                </div>
            </div>
        </div>

        <!-- Enhanced Settings Modal -->
        <div class="modal hidden" id="settingsModal">
            <div class="modal-content modal-content--large">
                <div class="modal-header">
                    <h3>Settings</h3>
                    <button class="modal-close" id="settingsModalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Settings Tabs -->
                    <div class="settings-tabs">
                        <button class="settings-tab active" data-tab="transcription">
                            <span class="tab-icon">üé§</span>
                            Transcription
                        </button>
                        <button class="settings-tab" data-tab="ai-prompts">
                            <span class="tab-icon">ü§ñ</span>
                            AI Prompts
                        </button>
                        <button class="settings-tab" data-tab="languages">
                            <span class="tab-icon">üåê</span>
                            Languages
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="settings-content">
                        <!-- Transcription Settings Tab -->
                        <div class="settings-tab-content active" id="transcription-tab">
                            <div class="settings-section">
                                <h4>AssemblyAI Configuration</h4>
                                <p class="text-muted">Configure real-time transcription service</p>
                                <div class="form-group">
                                    <label for="assemblyaiApiKey">AssemblyAI API Key:</label>
                                    <input type="password" id="assemblyaiApiKey" class="form-control" placeholder="Enter your AssemblyAI API key">
                                </div>
                                <div class="service-status-indicator">
                                    <span id="assemblyaiStatus" class="status-badge">Not Configured</span>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>Speech Model Selection</h4>
                                <p class="text-muted">Choose the AssemblyAI model for transcription accuracy and speed</p>
                                <div class="form-group">
                                    <label for="speechModel">Speech Model:</label>
                                    <select id="speechModel" class="form-control">
                                        <option value="universal">Universal - Fastest, most robust with broadest language support</option>
                                        <option value="universal_streaming">Universal Streaming (Default) - Optimized for real-time streaming</option>
                                        <option value="slam-1">Slam-1 - Most customizable for English transcription</option>
                                    </select>
                                </div>
                                <div class="model-info">
                                    <div class="info-card" id="modelInfo">
                                        <strong>Universal Streaming</strong>
                                        <p>Optimized for real-time streaming applications. Best for live transcription and streaming audio.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>Speaker Diarization</h4>
                                <p class="text-muted">Identify and label different speakers in your audio</p>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="enableSpeakerDiarization">
                                        <span class="checkmark"></span>
                                        Enable speaker diarization (identifies different speakers)
                                    </label>
                                </div>
                                <div class="form-group" id="speakerOptionsGroup" style="display: none;">
                                    <label for="speakersExpected">Expected number of speakers (optional):</label>
                                    <select id="speakersExpected" class="form-control">
                                        <option value="">Auto-detect</option>
                                        <option value="2">2 speakers</option>
                                        <option value="3">3 speakers</option>
                                        <option value="4">4 speakers</option>
                                        <option value="5">5 speakers</option>
                                        <option value="6">6 speakers</option>
                                        <option value="7">7 speakers</option>
                                        <option value="8">8 speakers</option>
                                        <option value="9">9 speakers</option>
                                        <option value="10">10 speakers</option>
                                    </select>
                                    <small class="form-text text-muted">Specifying the expected number can improve accuracy</small>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>Fallback Options</h4>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="enableWebSpeechFallback" checked>
                                        <span class="checkmark"></span>
                                        Use Web Speech API as fallback for transcription
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- AI Prompts Settings Tab -->
                        <div class="settings-tab-content" id="ai-prompts-tab">
                            <div class="settings-section">
                                <h4>Google Gemini AI Configuration</h4>
                                <p class="text-muted">Configure AI service for summaries, translations, and analysis</p>
                                <div class="form-group">
                                    <label for="geminiApiKey">Gemini API Key:</label>
                                    <input type="password" id="geminiApiKey" class="form-control" placeholder="Enter your Gemini API key">
                                </div>
                                <div class="service-status-indicator">
                                    <span id="geminiStatus" class="status-badge">Not Configured</span>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>Custom Summarization Prompt</h4>
                                <p class="text-muted">Customize how meeting summaries are generated. Use {transcript} as placeholder for transcript content.</p>
                                <div class="form-group">
                                    <label for="summaryPrompt">Summarization Prompt:</label>
                                    <textarea id="summaryPrompt" class="form-control prompt-textarea" rows="4" placeholder="Enter custom summarization prompt..."></textarea>
                                    <div class="prompt-validation" id="summaryPromptValidation"></div>
                                </div>
                                <div class="prompt-actions">
                                    <button class="btn btn--outline btn--sm" id="resetSummaryPrompt">Reset to Default</button>
                                    <button class="btn btn--secondary btn--sm" id="validateSummaryPrompt">Validate</button>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>Custom Translation Prompt</h4>
                                <p class="text-muted">Customize how translations are performed. Use {text} and {language} as placeholders.</p>
                                <div class="form-group">
                                    <label for="translationPrompt">Translation Prompt:</label>
                                    <textarea id="translationPrompt" class="form-control prompt-textarea" rows="4" placeholder="Enter custom translation prompt..."></textarea>
                                    <div class="prompt-validation" id="translationPromptValidation"></div>
                                </div>
                                <div class="prompt-actions">
                                    <button class="btn btn--outline btn--sm" id="resetTranslationPrompt">Reset to Default</button>
                                    <button class="btn btn--secondary btn--sm" id="validateTranslationPrompt">Validate</button>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>Fallback Options</h4>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="enableSimulationFallback" checked>
                                        <span class="checkmark"></span>
                                        Use simulation as fallback for AI features
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Languages Settings Tab -->
                        <div class="settings-tab-content" id="languages-tab">
                            <div class="settings-section">
                                <h4>Translation Languages</h4>
                                <p class="text-muted">Available languages for translation. New languages include enhanced Unicode support.</p>
                                <div class="language-grid">
                                    <div class="language-item">
                                        <span class="language-flag">üá™üá∏</span>
                                        <span class="language-name">Spanish</span>
                                        <span class="language-status">Available</span>
                                    </div>
                                    <div class="language-item">
                                        <span class="language-flag">üá´üá∑</span>
                                        <span class="language-name">French</span>
                                        <span class="language-status">Available</span>
                                    </div>
                                    <div class="language-item">
                                        <span class="language-flag">üá©üá™</span>
                                        <span class="language-name">German</span>
                                        <span class="language-status">Available</span>
                                    </div>
                                    <div class="language-item">
                                        <span class="language-flag">üáÆüáπ</span>
                                        <span class="language-name">Italian</span>
                                        <span class="language-status">Available</span>
                                    </div>
                                    <div class="language-item">
                                        <span class="language-flag">üáµüáπ</span>
                                        <span class="language-name">Portuguese</span>
                                        <span class="language-status">Available</span>
                                    </div>
                                    <div class="language-item">
                                        <span class="language-flag">üáØüáµ</span>
                                        <span class="language-name">Japanese</span>
                                        <span class="language-status">Available</span>
                                    </div>
                                    <div class="language-item">
                                        <span class="language-flag">üá∞üá∑</span>
                                        <span class="language-name">Korean</span>
                                        <span class="language-status">Available</span>
                                    </div>
                                    <div class="language-item">
                                        <span class="language-flag">üá®üá≥</span>
                                        <span class="language-name">Chinese</span>
                                        <span class="language-status">Available</span>
                                    </div>
                                    <div class="language-item language-item--new">
                                        <span class="language-flag">üá≤üá≤</span>
                                        <span class="language-name">Myanmar (Burmese)</span>
                                        <span class="language-status">New</span>
                                    </div>
                                    <div class="language-item language-item--new">
                                        <span class="language-flag">üáÆüá≥</span>
                                        <span class="language-name">Hindi</span>
                                        <span class="language-status">New</span>
                                    </div>
                                    <div class="language-item language-item--new">
                                        <span class="language-flag">üáßüá©</span>
                                        <span class="language-name">Bengali</span>
                                        <span class="language-status">New</span>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h4>Language Detection</h4>
                                <p class="text-muted">Configure automatic language detection during transcription</p>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="enableLanguageDetection" checked>
                                        <span class="checkmark"></span>
                                        Enable automatic language detection
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="confidenceThreshold">Confidence Threshold:</label>
                                    <div class="slider-group">
                                        <input type="range" id="confidenceThreshold" class="form-slider" min="0.5" max="1.0" step="0.05" value="0.7">
                                        <span class="slider-value" id="confidenceValue">70%</span>
                                    </div>
                                    <p class="text-muted">Languages detected below this confidence level will show a warning</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--outline" id="settingsModalCancel">Cancel</button>
                    <button class="btn btn--primary" id="saveSettings">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <!-- Debug script to catch early errors -->
    <script>
        console.log('üöÄ Starting AI Meeting Transcription Assistant...');
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error, 'at', e.filename + ':' + e.lineno);
        });
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM Content Loaded');
        });
        
        // Check if user is on debug page and show helpful message
        if (window.location.pathname === '/debug') {
            console.log('üîß Debug page detected - this is for troubleshooting only');
        }
    </script>
    
    <script src="{{ url_for('static', filename='startup_fix.js') }}"></script>
    <script src="{{ url_for('static', filename='config.js') }}"></script>
    <script src="{{ url_for('static', filename='startup_error_fix.js') }}"></script>
    <script src="{{ url_for('static', filename='emergency_loading_fix.js') }}"></script>
    
    <!-- Socket.IO with error handling and fallback -->
    <script>
        console.log('üì° Loading Socket.IO...');
        
        // Create Socket.IO script with error handling
        (function loadSocketIO() {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js';
            script.async = false; // Ensure scripts load in order
            
            script.onload = function() {
                console.log('‚úÖ Socket.IO loaded successfully from CDN');
                window.socketIOLoaded = true;
                loadRemainingScripts();
            };
            
            script.onerror = function() {
                console.warn('‚ö†Ô∏è Socket.IO CDN failed, creating mock Socket.IO for basic functionality');
                
                // Create a minimal Socket.IO mock to prevent errors
                window.io = function() {
                    return {
                        emit: function(event, data) { 
                            console.log(`Mock Socket.IO emit: ${event}`, data); 
                        },
                        on: function(event, callback) { 
                            console.log(`Mock Socket.IO listener: ${event}`); 
                        },
                        disconnect: function() { 
                            console.log('Mock Socket.IO disconnect'); 
                        },
                        connected: false
                    };
                };
                
                window.socketIOLoaded = false;
                console.log('‚úÖ Mock Socket.IO created - app will work in offline mode');
                loadRemainingScripts();
            };
            
            // Add timeout as additional failsafe
            setTimeout(() => {
                if (typeof window.socketIOLoaded === 'undefined') {
                    console.warn('üö® Socket.IO loading timeout, creating mock...');
                    script.onerror();
                }
            }, 5000);
            
            document.head.appendChild(script);
        })();
        
        function loadRemainingScripts() {
            console.log('üì¶ Loading remaining scripts...');
            // Continue with other scripts - they will load normally
        }
    </script>
    
    <script src="{{ url_for('static', filename='empty-state-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='dev-sample-data.js') }}"></script>
    <script src="{{ url_for('static', filename='help-system.js') }}"></script>
    
    <!-- Modular JavaScript Components -->
    <script src="{{ url_for('static', filename='js/websocket-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/assemblyai-service.js') }}"></script>
    <script src="{{ url_for('static', filename='js/gemini-service.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app-main.js') }}"></script>
    
    <!-- Pre-initialization safety check -->
    <script>
        console.log('üîß Pre-initialization safety check...');
        
        // Ensure Socket.IO is available before app initialization
        if (typeof io === 'undefined') {
            console.error('üö® Socket.IO not available during app initialization!');
            
            // Create emergency mock if still missing
            window.io = function() {
                return {
                    emit: function(event, data) { console.log(`Emergency Mock emit: ${event}`, data); },
                    on: function(event, callback) { console.log(`Emergency Mock listener: ${event}`); },
                    disconnect: function() { console.log('Emergency Mock disconnect'); },
                    connected: false
                };
            };
            console.log('üÜò Emergency Socket.IO mock created');
        }
        
        // Add safety wrapper for app initialization
        const originalInitializeApp = window.initializeApp;
        if (typeof originalInitializeApp === 'function') {
            window.initializeApp = async function() {
                try {
                    console.log('üöÄ Starting safe app initialization...');
                    await originalInitializeApp();
                } catch (error) {
                    console.error('‚ùå App initialization failed:', error);
                    
                    // Show user-friendly error and make UI functional
                    const errorDiv = document.createElement('div');
                    errorDiv.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: #fff3cd;
                        color: #856404;
                        border: 1px solid #ffeaa7;
                        padding: 15px 20px;
                        border-radius: 8px;
                        z-index: 10000;
                        font-family: Arial, sans-serif;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    `;
                    errorDiv.innerHTML = `
                        <strong>‚ö†Ô∏è Application Running in Safe Mode</strong><br>
                        Some features may be limited due to network connectivity.<br>
                        Basic functionality should still work.
                    `;
                    document.body.appendChild(errorDiv);
                    
                    // Auto-hide the message after 10 seconds
                    setTimeout(() => errorDiv.remove(), 10000);
                }
            };
        }
        
        // Ensure buttons are clickable by adding basic event handling
        setTimeout(() => {
            const buttons = document.querySelectorAll('button:not([onclick])');
            buttons.forEach((button, index) => {
                if (!button.onclick && !button.getAttribute('data-event-handled')) {
                    button.addEventListener('click', function(e) {
                        console.log(`Button clicked: ${button.textContent || button.id || 'button-' + index}`);
                        
                        // Basic button functionality based on common patterns
                        if (button.id === 'recordButton' || button.textContent.includes('Record')) {
                            alert('Recording feature requires full app initialization. Please refresh the page.');
                        } else if (button.textContent.includes('Stop') || button.textContent.includes('Pause')) {
                            alert('Playback controls require full app initialization. Please refresh the page.');
                        } else {
                            console.log('Button click handled in safe mode');
                        }
                    });
                    button.setAttribute('data-event-handled', 'true');
                }
            });
            console.log(`‚úÖ Added safe-mode click handlers to ${buttons.length} buttons`);
        }, 2000);
    </script>
    
    <script src="{{ url_for('static', filename='debug_init.js') }}"></script>
    <script src="{{ url_for('static', filename='emergency_bypass.js') }}"></script>
    
    <!-- Final initialization check -->
    <script>
        window.addEventListener('load', function() {
            console.log('‚úÖ All resources loaded');
            if (typeof window.appConfig !== 'undefined') {
                console.log('‚úÖ Config loaded:', window.appConfig.getEnvironment());
            } else {
                console.error('‚ùå Config not loaded');
            }
            if (typeof io !== 'undefined') {
                if (window.socketIOLoaded === true) {
                    console.log('‚úÖ Socket.IO loaded from CDN');
                } else {
                    console.log('‚úÖ Socket.IO mock loaded (offline mode)');
                }
            } else {
                console.error('‚ùå Socket.IO not loaded');
            }
            
            // Additional UI responsiveness check
            setTimeout(() => {
                const buttons = document.querySelectorAll('button');
                console.log(`üìç Found ${buttons.length} buttons on page`);
                
                if (buttons.length === 0) {
                    console.warn('‚ö†Ô∏è No buttons found - UI might not be loaded properly');
                }
            }, 1000);
        });
    </script>
    
    <!-- Final failsafe to ensure app is visible -->
    <script>
        console.log('üöÄ FINAL FAILSAFE: Ensuring app visibility...');
        
        function forceShowApp() {
            // Hide loading indicator
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
                console.log('‚úÖ FINAL: Loading indicator hidden');
            }
            
            // Show app container
            const appContainer = document.querySelector('.app-container');
            if (appContainer) {
                appContainer.style.display = 'flex';
                appContainer.style.flexDirection = 'column';
                appContainer.style.visibility = 'visible';
                appContainer.style.opacity = '1';
                appContainer.style.minHeight = '100vh';
                appContainer.style.position = 'relative';
                appContainer.style.zIndex = '1';
                console.log('‚úÖ FINAL: App container shown');
            }
            
            console.log('‚úÖ FINAL: App should now be visible');
        }
        
        // Try immediately if DOM is ready
        if (document.readyState !== 'loading') {
            setTimeout(forceShowApp, 100);
        } else {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(forceShowApp, 100);
            });
        }
        
        // Emergency backup timer
        setTimeout(forceShowApp, 2000);
        
        // Update JavaScript status indicator
        try {
            const statusBanner = document.getElementById('jsStatusBanner');
            const statusText = document.getElementById('jsStatusText');
            if (statusBanner && statusText) {
                statusText.textContent = '‚úÖ JavaScript Status: Working - Full functionality available';
                statusBanner.style.background = '#d4edda';
                statusBanner.style.color = '#155724';
                statusBanner.style.border = '1px solid #c3e6cb';
            }
        } catch (e) {
            // Ignore if elements don't exist
        }
    </script>
</body>
</html>
